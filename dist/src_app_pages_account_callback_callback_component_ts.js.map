{"version":3,"file":"src_app_pages_account_callback_callback_component_ts.js","mappings":"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","sources":["./src/app/pages/account/callback/callback.component.ts"],"sourcesContent":["import { Component, OnInit } from '@angular/core';\nimport { Router, ActivatedRoute } from '@angular/router';\nimport { fetchAuthSession, getCurrentUser } from 'aws-amplify/auth';\nimport { IonContent, IonSpinner, IonText } from '@ionic/angular/standalone';\n\n@Component({\n  selector: 'app-callback',\n  standalone: true,\n  imports: [\n    IonContent,\n    IonSpinner,\n    IonText\n  ],\n  template: `\n      <ion-content class=\"ion-padding\">\n        <div style=\"display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; text-align: center;\">\n          <ion-spinner color=\"primary\"></ion-spinner>\n          <ion-text color=\"primary\" style=\"margin-top: 20px;\">\n            <h3>Processing OAuth callback...</h3>\n            <p>Please wait while we complete your sign-in.</p>\n          </ion-text>\n        </div>\n      </ion-content>`\n})\nexport class CallbackComponent implements OnInit {\n  constructor(\n    private router: Router,\n    private route: ActivatedRoute\n  ) {}\n\n  async ngOnInit() {\n    console.log('ðŸ”— OAuth callback component initialized');\n\n    // Get parameters from Angular route (for deep link navigation) or URL (for web navigation)\n    const routeParams = this.route.snapshot.queryParams;\n    const urlParams = new URLSearchParams(window.location.search);\n\n    const code = routeParams['code'] || urlParams.get('code');\n    const error = routeParams['error'] || urlParams.get('error');\n    const currentUrl = window.location.href;\n\n    console.log('ðŸ”— Callback URL:', currentUrl);\n    console.log('ðŸ”— Route params:', routeParams);\n    console.log('ðŸ”— OAuth code:', code);\n    console.log('ðŸ”— OAuth error:', error);\n\n    if (error) {\n      console.error('ðŸ”— OAuth error received:', error);\n      this.router.navigate(['/account/signup'], {\n        queryParams: { error: 'OAuth authentication failed' }\n      });\n      return;\n    }\n\n    if (code) {\n      console.log('ðŸ”— Authorization code received, waiting for Amplify to process...');\n\n      // Give Amplify some time to process the OAuth callback\n      await this.waitForAuthentication();\n    } else {\n      console.warn('ðŸ”— No authorization code found in callback URL');\n      this.router.navigate(['/account/signup']);\n    }\n  }\n\n  private async waitForAuthentication(maxAttempts = 10, delayMs = 1000): Promise<void> {\n    for (let attempt = 1; attempt <= maxAttempts; attempt++) {\n      try {\n        console.log(`ðŸ”— Checking authentication status (attempt ${attempt}/${maxAttempts})...`);\n\n        const session = await fetchAuthSession();\n        if (session.tokens?.idToken) {\n          console.log('ðŸ”— Authentication successful! Redirecting to home...');\n          this.router.navigate(['/home']);\n          return;\n        }\n\n        // Also try getCurrentUser as a double-check\n        const user = await getCurrentUser();\n        if (user) {\n          console.log('ðŸ”— User authenticated via getCurrentUser! Redirecting to home...');\n          this.router.navigate(['/home']);\n          return;\n        }\n      } catch (error) {\n        console.log(`ðŸ”— Authentication not ready yet (attempt ${attempt}):`, error.message || error);\n      }\n\n      if (attempt < maxAttempts) {\n        await new Promise(resolve => setTimeout(resolve, delayMs));\n      }\n    }\n\n    console.error('ðŸ”— Authentication timeout - redirecting to signup');\n    this.router.navigate(['/account/signup'], {\n      queryParams: { error: 'Authentication timeout' }\n    });\n  }\n}\n"],"names":["Component","Router","ActivatedRoute","fetchAuthSession","getCurrentUser","IonContent","IonSpinner","IonText","CallbackComponent","router","route","constructor","ngOnInit","_this","_asyncToGenerator","console","log","routeParams","snapshot","queryParams","urlParams","URLSearchParams","window","location","search","code","get","error","currentUrl","href","navigate","waitForAuthentication","warn","_this2","maxAttempts","delayMs","attempt","session","tokens","idToken","user","message","Promise","resolve","setTimeout","apply","arguments","__decorate","selector","standalone","imports","template"],"sourceRoot":"webpack:///","x_google_ignoreList":[]}