{"version":3,"file":"src_app_pages_account_callback_callback_component_ts.js","mappings":"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","sources":["./src/app/pages/account/callback/callback.component.ts"],"sourcesContent":["import { Component, OnInit } from '@angular/core';\nimport { Router, ActivatedRoute } from '@angular/router';\nimport { fetchAuthSession, getCurrentUser } from 'aws-amplify/auth';\nimport { IonContent, IonSpinner, IonText } from '@ionic/angular/standalone';\n\n@Component({\n  selector: 'app-callback',\n  standalone: true,\n  imports: [\n    IonContent,\n    IonSpinner,\n    IonText\n  ],\n  template: `\n      <ion-content class=\"ion-padding\">\n        <div style=\"display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; text-align: center;\">\n          <ion-spinner color=\"primary\"></ion-spinner>\n          <ion-text color=\"primary\" style=\"margin-top: 20px;\">\n            <h3>Processing OAuth callback...</h3>\n            <p>Please wait while we complete your sign-in.</p>\n          </ion-text>\n        </div>\n      </ion-content>`\n})\nexport class CallbackComponent implements OnInit {\n  constructor(\n    private router: Router,\n    private route: ActivatedRoute\n  ) {}\n\n  async ngOnInit() {\n    console.log('ðŸ”— OAuth callback component initialized');\n\n    // Log the current URL and parameters for debugging\n    const currentUrl = window.location.href;\n    const urlParams = new URLSearchParams(window.location.search);\n    const code = urlParams.get('code');\n    const error = urlParams.get('error');\n\n    console.log('ðŸ”— Callback URL:', currentUrl);\n    console.log('ðŸ”— OAuth code:', code);\n    console.log('ðŸ”— OAuth error:', error);\n\n    if (error) {\n      console.error('ðŸ”— OAuth error received:', error);\n      this.router.navigate(['/account/signup'], {\n        queryParams: { error: 'OAuth authentication failed' }\n      });\n      return;\n    }\n\n    if (code) {\n      console.log('ðŸ”— Authorization code received, waiting for Amplify to process...');\n\n      // Give Amplify some time to process the OAuth callback\n      await this.waitForAuthentication();\n    } else {\n      console.warn('ðŸ”— No authorization code found in callback URL');\n      this.router.navigate(['/account/signup']);\n    }\n  }\n\n  private async waitForAuthentication(maxAttempts = 10, delayMs = 1000): Promise<void> {\n    for (let attempt = 1; attempt <= maxAttempts; attempt++) {\n      try {\n        console.log(`ðŸ”— Checking authentication status (attempt ${attempt}/${maxAttempts})...`);\n\n        const session = await fetchAuthSession();\n        if (session.tokens?.idToken) {\n          console.log('ðŸ”— Authentication successful! Redirecting to home...');\n          this.router.navigate(['/home']);\n          return;\n        }\n\n        // Also try getCurrentUser as a double-check\n        const user = await getCurrentUser();\n        if (user) {\n          console.log('ðŸ”— User authenticated via getCurrentUser! Redirecting to home...');\n          this.router.navigate(['/home']);\n          return;\n        }\n      } catch (error) {\n        console.log(`ðŸ”— Authentication not ready yet (attempt ${attempt}):`, error.message || error);\n      }\n\n      if (attempt < maxAttempts) {\n        await new Promise(resolve => setTimeout(resolve, delayMs));\n      }\n    }\n\n    console.error('ðŸ”— Authentication timeout - redirecting to signup');\n    this.router.navigate(['/account/signup'], {\n      queryParams: { error: 'Authentication timeout' }\n    });\n  }\n}\n"],"names":["Component","Router","ActivatedRoute","fetchAuthSession","getCurrentUser","IonContent","IonSpinner","IonText","CallbackComponent","router","route","constructor","ngOnInit","_this","_asyncToGenerator","console","log","currentUrl","window","location","href","urlParams","URLSearchParams","search","code","get","error","navigate","queryParams","waitForAuthentication","warn","_this2","maxAttempts","delayMs","attempt","session","tokens","idToken","user","message","Promise","resolve","setTimeout","apply","arguments","__decorate","selector","standalone","imports","template"],"sourceRoot":"webpack:///","x_google_ignoreList":[]}